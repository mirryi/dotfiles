#!/bin/sh

# XDG base directory specification
export XDG_CACHE_HOME="${HOME}/.cache"
export XDG_CONFIG_HOME="${HOME}/.config"
export XDG_DATA_HOME="${HOME}/.local/share"
export XDG_STATE_HOME="${HOME}/.local/var/lib"
export XDG_LIB_HOME="${HOME}/.local/lib"
export XDG_LOG_HOME="${HOME}/.local/var/log"
export LD_LIBRARY_PATH="${XDG_LIB_HOME}"
export XDG_DATA_DIRS="${XDG_DATA_HOME}:/usr/local/share:/usr/share"

# fix QT display bugs
export QT_AUTO_SCREEN_SCALE_FACTOR=0

# XDG base directory fixes
export BASH_COMPLETION_USER_FILE="${XDG_CONFIG_HOME}/bash-completion/bash_completion"
export HISTFILE="${XDG_DATA_HOME}/bash/history"
export INPUTRC="${XDG_CONFIG_HOME}/readline/inputrc"

__files_in() {
  if [[ -d "$1" ]]; then
    find "$1" -maxdepth 1 -mindepth 1 -not -path '\.*'
  fi
}

__source_files() {
  if [[ "$(__files_in "$1")" ]]; then
    for f in "$1/"*; do
      . "$f"
    done
  fi
}

# Local user binaries
if [ -d "$HOME/.local/bin" ]; then
  export PATH="$PATH:$HOME/.local/bin"
fi

# load other env files
__source_files "$XDG_CONFIG_HOME/sh/envc"

# Remove duplicates from PATH
old_PATH=$PATH:
PATH=
while [ -n "$old_PATH" ]; do
  x=${old_PATH%%:*}
  case $PATH: in
  *:"$x":*) ;;
  *) PATH=$PATH:$x ;;
  esac
  old_PATH=${old_PATH#*:}
done
PATH=${PATH#:}
unset old_PATH x

# define aliases
. "$XDG_CONFIG_HOME/sh/aliases"
__source_files "$XDG_CONFIG_HOME/sh/aliasc"

# load other local files
__source_files "$XDG_CONFIG_HOME/sh/local"
